<% var theEvent = '' %>
<%- include header %>
    
    <div class="rzv-lightbox">

      <a href="javascript:window.print()" class="reservations-print"><i class="fa fa-print"></i> Print this page</a>

      <h2>Reservations</h2>

      <div class="logo-print">
        <img src="/media/rsvr-logo-black-print.png" alt="">
      </div>

      <h4><a href="/dashboard/<%= org._id %>/event/<%= event._id %>"><%= event.name %></a></h4>
      <span class="event-date"><%= moment(event.date).format('LLLL') %></span>

      <div class="alert alert-warning alert-warning-seats">
        <a href="" class="close">&times;</a>
        <p></p>
      </div>

      <div class="alert alert-success alert-success-seats">
        <a href="" class="close">&times;</a>
        <p></p>
      </div>

      <table class="table-reservations table table-striped">
        <thead>
          <tr>
            <th>
              Name
            </th>
            <th>
              Date &amp; time
            </th>
            <th>
              Email
            </th>
            <th>
              Seats
            </th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% var i = 1; var s = 0; %>
          <% reservations.forEach(function(reservation){ %>
            <% if (!reservation.waiting)  { %>
            <tr>
              <td>

                <%= i %>. <%= reservation.name %>
                <% i = i + 1 %>
              </td>
              <td>
                <% if (reservation.timestamp) { %>
                  <%= moment(reservation.timestamp).format() %>
                <% } %>
              </td>
              <td>
                <%= reservation.email %>
              </td>
              <td>
                
                <div class="field-update field-update-seats">
                  
                  <div class="field-update-fields">
                    
                    <input type="text" class="form-control input-sm" value="<%= reservation.seats %>">
                    
                    <a href="" class="btn btn-primary btn-sm btn-save" data-reservationid="<%= reservation._id %>">Save</a>

                  </div>
                
                  <div class="field-update-placeholder">
                    
                    <span class="seats">
                      <%= reservation.seats %>
                    </span>

                    <a href="" class="btn btn-default btn-xs">Edit</a>

                  </div>

                </div>
                <% s = s + parseInt(reservation.seats) %>
              </td>
              <td>

                <a href="/u/delete-reservation/<%= reservation._id %>" class="btn btn-danger btn-xs btn-remove-item" data-message="Are you sure you want to delete this reservation?">
                  <i class="fa fa-times-circle"></i>
                  Delete
                </a>

              </td>
            </tr>
            <% } %>
          <% });%>
        </tbody>
        <tfoot>
          <td>
            <strong>Total reserved seats :</strong>
          </td>
          <td>
            
          </td>
          <td>
            
          </td>
          <td>
            <strong><%= s %></strong>
          </td>
          <td>
            
          </td>
        </tfoot>
      </table>
      <% var waiting = false %>
      <% reservations.forEach(function(r){ %>
        <% if (r.waiting) { %>
          <% waiting = true %>
        <% } %>
      <% }) %>

      <% if (waiting) { %>
      
      <h2>Waiting list</h2>
    
      <table class="table-reservations table table-striped">
        <thead>
          <tr>
            <th>
              Name
            </th>
            <th>Date &amp; Time</th>
            <th>
              Email
            </th>
            <th>
              Seats
            </th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% var m = 1; var ws = 0; %>
          <% reservations.forEach(function(reservation){ %>
            <% if (reservation.waiting)  { %>
            <tr>
              <td>
                <%= m %>. <%= reservation.name %>
                <% m = m +1; ws = ws + parseInt(reservation.seats) %>
              </td>
              <td>
                <% if (reservation.timestamp) { %>
                  <%= moment(reservation.timestamp).format() %>
                <% } %>
              </td>
              <td>
                <%= reservation.email %>
              </td>
              <td>
                <%= reservation.seats %>
              </td>
              <td>
                <a href="/u/delete-reservation/<%= reservation._id %>" class="btn btn-danger btn-xs btn-remove-item" data-message="Are you sure you want to delete this reservation?">
                  <i class="fa fa-times-circle"></i>
                  Delete
                </a>
              </td>
            </tr>
            <% } %>
          <% });%>
        </tbody>
        <tfoot>
          <td>
            <strong>Total waiting seats :</strong>
          </td>
          <td>
            
          </td>
          <td>
            <strong><%= ws %></strong>
          </td>
          <td>
            
          </td>
        </tfoot>
      </table>
      <% } %>
    </div>

      
    

<%- include footer %>
